name: PR Assignment Check

on:
  pull_request_target:
    types: [opened, reopened, edited]
  workflow_dispatch:
    inputs:
      pr_number:
        description: "PR number to check"
        required: true
        type: number

jobs:
  check:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      issues: read
      pull-requests: write
      id-token: write
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: ${{ secrets.CLAUDE_CODE_API_KEY }}
          github_token: ${{ secrets.GITHUB_TOKEN }}
          show_full_output: true
          prompt: |
            EXEMPT USERS: @maxprilutskiy, @vrcprl, @davidturnbull, @monicabe, @sumitsaurabh927, @AleksandrSl, @cherkanovart (skip all checks if PR author is one of these)

            Close this PR if:
            1. It doesn't reference any issue (no "Closes #123", "Fixes #456", etc.)
            2. OR it references an issue where the PR author is NOT assigned

            When closing, leave a brief, friendly comment (2-3 sentences, no emojis) explaining:
            - They need to reference an assigned issue or get assigned first
            - They should find unassigned issues to work on

            Otherwise, do nothing.
          claude_args: |
            --allowedTools "Bash,Read,Grep,Glob"
